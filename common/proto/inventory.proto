syntax = "proto3";

package inventory;

service InventoryService {
  rpc RestockStock (RestockStockRequest) returns (InventoryResponse);
  rpc ReserveStock (ReserveStockRequest) returns (ReserveStockResponse);
}

// --- ENUMS ---

// Map với enum TransType trong Prisma
// Proto bắt buộc phần tử đầu tiên phải là số 0
enum TransactionType {
  TRANS_UNKNOWN = 0; 
  TRANS_INBOUND = 1;  // Nhập kho
  TRANS_OUTBOUND = 2; // Xuất kho
  TRANS_RESERVE = 3;  // Giữ hàng
  TRANS_RELEASE = 4;  // Trả hàng giữ
}

// --- MESSAGES ---

message InventoryResponse {
  int32 id = 1;
  string product_id = 2; // ID String từ MongoDB
  string sku = 3;
  
  int32 stock_quantity = 4;    // Tổng tồn kho vật lý
  int32 reserved_stock = 5;    // Hàng đang bị giữ
  int32 available_quantity = 6; // Field tính toán (Stock - Reserved) để Frontend dễ hiển thị
  
  string last_updated = 7;     // ISO Date String
}

message RestockStockRequest {
  string product_id = 1;
  string sku = 2;
  int32 quantity = 3;
}

message Item {
  string product_id = 1;
  int32 quantity = 2;
}

message ReserveStockRequest {
  string order_id = 1;
  repeated Item items = 2;
}

message ReserveStockResponse {
  bool success = 1;
}

