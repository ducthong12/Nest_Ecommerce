syntax = "proto3";

package product; // Tên package, dùng để config trong NestJS

// Import Empty nếu muốn dùng cho hàm Delete trả về rỗng
// import "google/protobuf/empty.proto"; 

service PRODUCT_SERVICE {
  // Lấy 1 sản phẩm theo ID
  rpc FindOne (FindOneRequest) returns (ProductResponse);

  // Tạo sản phẩm mới
  rpc Create (CreateProductRequest) returns (ProductResponse);

  // Cập nhật sản phẩm
  rpc Update (UpdateProductRequest) returns (ProductResponse);

  // Xóa sản phẩm
  rpc Delete (FindOneRequest) returns (DeleteResponse);
  
  // Tìm kiếm danh sách (có phân trang)
  rpc FindAll (FindAllRequest) returns (FindAllResponse);
}

// --- MESSAGE DEFINITIONS ---

// 1. Model Brand (Rút gọn để nhúng vào Product)
message Brand {
  string id = 1;
  string name = 2;
  string description = 3;
}

// 2. Model Category (Rút gọn để nhúng vào Product)
message Category {
  string id = 1;
  string name = 2;
}

// 3. Model Product (Response trả về client)
message ProductResponse {
  string id = 1;            // Map với _id của MongoDB
  string name = 2;
  string description = 3;
  double price = 4;         // Float/Double cho giá tiền
  string sku = 5;
  string image_url = 6;     // Proto dùng snake_case
  bool is_active = 7;
  
  // External Reference
  int32 user_id = 8;        // ID từ Postgres (Int)

  // Relations (Đã populate data)
  Brand brand = 9;          
  Category category = 10;   

  // Stats
  int32 likes_count = 11;
  int32 view_count = 12;
  float rating = 13;        // Rating thường dùng float là đủ
  
  string created_at = 14;   // Date gửi qua gRPC thường convert sang ISO String
  string updated_at = 15;
}

// --- REQUEST DTOs ---

message FindOneRequest {
  string id = 1;
}

message CreateProductRequest {
  string name = 1;
  string description = 2;
  double price = 3;
  string sku = 4;
  string image_url = 5;
  bool is_active = 6;
  int32 user_id = 7;
  
  // Khi tạo, ta chỉ truyền ID chuỗi của Brand/Category
  string brand_id = 8;      
  string category_id = 9;
}

message UpdateProductRequest {
  string id = 1;
  // Dùng optional để biết field nào cần update, field nào không
  optional string name = 2;
  optional string description = 3;
  optional double price = 4;
  optional string image_url = 5;
  optional bool is_active = 6;
  optional string brand_id = 7;
  optional string category_id = 8;
}

message DeleteResponse {
  bool success = 1;
  string message = 2;
}

message FindAllRequest {
  int32 page = 1;
  int32 limit = 2;
  string search = 3; // Search theo tên
}

message FindAllResponse {
  repeated ProductResponse products = 1; // Danh sách sản phẩm
  int32 total = 2;                       // Tổng số bản ghi
}