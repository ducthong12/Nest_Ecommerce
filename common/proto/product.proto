syntax = "proto3";

package product;

import "google/protobuf/empty.proto";

service ProductService {
  rpc CreateProduct (CreateProductRequest) returns (ProductResponse);
  rpc CreateManyProduct (CreateManyProductRequest) returns (ManyProductResponse);
  rpc UpdateProduct (UpdateProductRequest) returns (ProductResponse);
  rpc FindAllProducts (FindProductRequest) returns (ProductListResponse);
  rpc FindOneProduct (FindOneRequest) returns (ProductResponse);
  rpc CreateCategory (CreateCategoryRequest) returns (CategoryResponse);
  rpc CreateBrand (CreateBrandRequest) returns (BrandResponse);
}

message CreateProductRequest {
  string name = 1;
  optional string description = 2;
  optional string thumbnail_url = 3;
  optional bool is_active = 4;

  int32 user_id = 5;        
  string brand = 6;         
  string category = 7;      

  repeated ProductVariant variants = 8;
  repeated SpecificationItem specifications = 9;
}

message CreateManyProductRequest {
  repeated CreateProductRequest products = 1;
}

message UpdateProductRequest {
  int32 id = 1;
  optional string name = 2;
  optional string description = 3;
  optional string thumbnail_url = 4;
  optional bool is_active = 5;
       
  optional string brand = 6;         
  optional string category = 7;      

  repeated ProductVariant variants = 8;
  repeated SpecificationItem specifications = 9;
}

message FindProductRequest {
  optional string search = 1;
  optional int32 page = 2;
  optional int32 limit = 3;
  optional string sort = 4;
  optional string category_id = 5;
}

message FindOneRequest {
  string id = 1;
}

message ProductResponse {
  string id = 1;        // Map từ _id của Mongo
  string name = 2;
  string description = 3;
  double price = 4;
  string sku = 5;
  string thumbnail_url = 6;
  bool is_active = 7;
  int32 user_id = 8;
  
  // Quan hệ (Populate) trả về Object hoặc String tùy logic
  string brand_name = 9;   
  string category_name = 10;
  
  int32 view_count = 11;
  int32 likes_count = 12;
  string created_at = 13;
  repeated SpecificationItem specifications = 14;
}

message ManyProductResponse {
  repeated ProductResponse products = 1;
}

message ProductListResponse {
  repeated ProductResponse products = 1; // Mảng sản phẩm
  Meta meta = 2; // Phân trang
}

message Meta {
  int32 total = 1;
  int32 page = 2;
  int32 last_page = 3;
}

message CreateCategoryRequest {
  string name = 1;
}

message CreateBrandRequest {
  string name = 1;
  optional string description = 2;
}

message CategoryResponse {
  string name = 1;
}

message BrandResponse {
  string name = 1;
  optional string description = 2;
}

message ProductVariant {
  string sku = 1;
  double price = 2;
  optional string image_url = 3;
  repeated VariantAttribute attributes = 4;
}

message VariantAttribute {
  string k = 1;
  string v = 2;
}

message SpecificationItem {
  string key = 1;
  string value = 2;
}