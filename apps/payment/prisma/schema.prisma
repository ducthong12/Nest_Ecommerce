generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x", "debian-openssl-3.0.x"]
  output        = "../../../node_modules/@generated/payment-service"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL_PAYMENT")
}

model Payment {
  id            String        @id @default(uuid()) // UUID cho giao dịch thanh toán
  orderId       BigInt        @unique @map("order_id") // ID đơn hàng từ Order Service
  amount        Decimal       @db.Decimal(12, 2)
  currency      String        @default("VND")
  status        PaymentStatus @default(PENDING)
  provider      String?       // VNPAY, MOMO, STRIPE
  transactionId String?       @map("transaction_id") // Mã giao dịch từ cổng thanh toán trả về
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  @@map("payments")
}

model Outbox {
  id          String   @id @default(uuid())
  topic       String   // Tên topic Kafka (vd: 'payment.init')
  payload     Json     // Nội dung message
  status      String   @default("PENDING") // PENDING, COMPLETED, FAILED
  retryCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([status])
  @@map("outbox")
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  EXPIRED // Trạng thái khi quá 10 phút
}
